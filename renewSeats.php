<?php
$servername = "127.0.0.1";
$username = "root";
$password = "root";
$database = "CheckChack";
// 创建连接
$conn = new mysqli($servername, $username, $password, $database);
 
// 检测连接
if ($conn->connect_error) {
    die("连接失败: " . $conn->connect_error);
} 

$del_res = mysqli_query( $conn, "DROP TABLE Seats" );
if(!$del_res )
{
  die('数据表删除失败: ' . mysqli_error($conn));
}
echo "数据表删除成功\n";
//创建Seats Table.
//Statu: 0=empty, 1=reserve, 2=taken, 3=operating
//type: sin, duo, sofa ...
$creat = "CREATE TABLE IF NOT EXISTS `Seats` (
		`seat_id` varchar(32) COLLATE utf8mb4_unicode_ci NOT NULL,
		`state` int NOT NULL DEFAULT 0,
		`type` varchar(68) COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'sin',
		`loca_y` float(5) NOT NULL DEFAULT 0.0000,
		`loca_x` float(5) NOT NULL DEFAULT 0.0000,
		`time_marker` int,
		`mark_user` varchar(32) DEFAULT 'NULL',
		`create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
		`curr_user_id` varchar(32) COLLATE utf8mb4_unicode_ci DEFAULT 'NULL',
		`last_user_id` varchar(32) COLLATE utf8mb4_unicode_ci DEFAULT 'NULL',
		`usage_count` int NOT NULL DEFAULT 0,
		PRIMARY KEY (`seat_id`),
		KEY `seat_id` (`seat_id`) USING BTREE
	) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='SeatsInfo';";
$creat_res = mysqli_query($conn, $creat);
if (!$creat_res) {
	die('数据表建立失败: ' . mysqli_error($conn));
}
echo "数据表建立成功\n";
//插入测试数据
$sql = "INSERT INTO Seats (seat_id, state, loca_x, loca_y) 
		VALUES ('L405001', 0, 0.0766, 0.2338), 
		 	   ('L405002', 0, 0.0766, 0.3106),
		 	   ('L405003', 0, 0.0766, 0.3803),
		 	   ('L405004', 0, 0.0766, 0.4564),
		 	   ('L405005', 0, 0.0766, 0.5190),
		 	   ('L405006', 2, 0.0766, 0.5959),
		 	   ('L405007', 2, 0.0766, 0.6632),
		 	   ('L405008', 2, 0.1041, 0.6632),
		 	   ('L405009', 0, 0.0766, 0.7488),
		 	   ('L405010', 0, 0.1041, 0.7488),
			   ('L405011', 0, 0.0766, 0.7964),
			   ('L405012', 0, 0.1041, 0.7964),
			   ('L405013', 0, 0.0766, 0.8819),
			   ('L405014', 0, 0.1041, 0.8819),
			   ('L405015', 0, 0.1715, 0.1680),
			   ('L405016', 0, 0.1715, 0.2322),
			   ('L405017', 0, 0.2264, 0.1498),
			   ('L405018', 0, 0.2264, 0.1823),
			   ('L405019', 0, 0.2971, 0.1498),
			   ('L405020', 0, 0.2971, 0.1823),
			   ('L405021', 0, 0.2264, 0.2179),
			   ('L405022', 0, 0.2264, 0.2504),
			   ('L405023', 0, 0.2971, 0.2179),
			   ('L405024', 0, 0.2971, 0.2504),
			   ('L405025', 0, 0.3495, 0.2353),
			   ('L405026', 0, 0.3776, 0.2330),
			   ('L405027', 0, 0.4064, 0.2235),
			   ('L405028', 0, 0.4313, 0.2036),
			   ('L405029', 0, 0.4529, 0.1791),
			   ('L405030', 0, 0.4705, 0.1513),
			   ('L405031', 0, 0.4823, 0.1197),
			   ('L405032', 0, 0.4882, 0.0864),
			   ('L405033', 0, 0.2153, 0.5491),
			   ('L405034', 0, 0.2317, 0.5182),
			   ('L405035', 0, 0.2507, 0.4897),
			   ('L405036', 0, 0.2736, 0.4675),
			   ('L405037', 0, 0.3017, 0.4532),
			   ('L405038', 0, 0.3305, 0.4485),
			   ('L405039', 0, 0.2022, 0.6632),
			   ('L405040', 0, 0.1983, 0.6965),
			   ('L405041', 0, 0.4012, 0.4398),
			   ('L405042', 0, 0.4287, 0.4342),
			   ('L405043', 0, 0.4627, 0.4342),
			   ('L405044', 0, 0.4967, 0.4342),
			   ('L405045', 0, 0.5301, 0.4342),
			   ('L405046', 0, 0.5569, 0.4398),
			   ('L405047', 0, 0.5569, 0.5166),
			   ('L405048', 0, 0.5301, 0.5238),
			   ('L405049', 0, 0.4967, 0.5238),
			   ('L405050', 0, 0.4627, 0.5238),
			   ('L405051', 0, 0.4287, 0.5238),
			   ('L405052', 0, 0.4012, 0.5166),
			   ('L405053', 0, 0.3050, 0.6712),
			   ('L405054', 0, 0.3253, 0.6997),
			   ('L405055', 0, 0.3482, 0.7211),
			   ('L405056', 0, 0.3757, 0.7361),
			   ('L405057', 0, 0.4038, 0.7409),
			   ('L405058', 0, 0.4496, 0.7409),
			   ('L405059', 0, 0.4777, 0.7361),
			   ('L405060', 0, 0.5052, 0.7211),
			   ('L405061', 0, 0.5288, 0.6997),
			   ('L405062', 0, 0.5484, 0.6712),
			   ('L405063', 0, 0.1983, 0.8344),
			   ('L405064', 0, 0.2022, 0.8677),
			   ('L405065', 0, 0.2467, 0.8582),
			   ('L405066', 0, 0.2467, 0.8906),
			   ('L405067', 0, 0.3181, 0.8582),
			   ('L405068', 0, 0.3181, 0.8906),
			   ('L405069', 0, 0.4025, 0.8582),
			   ('L405070', 0, 0.4025, 0.8906),
			   ('L405071', 0, 0.4738, 0.8582),
			   ('L405072', 0, 0.4738, 0.8906),
			   ('L405073', 0, 0.5510, 0.8582),
			   ('L405074', 0, 0.5510, 0.8906),
			   ('L405075', 0, 0.6224, 0.8582),
			   ('L405076', 0, 0.6224, 0.8906),
			   ('L405077', 0, 0.7081, 0.8938),
			   ('L405078', 0, 0.7114, 0.8597),
			   ('L405079', 0, 0.7232, 0.8257),
			   ('L405080', 0, 0.7408, 0.7971),
			   ('L405081', 0, 0.7644, 0.7734),
			   ('L405082', 0, 0.6819, 0.6735),
			   ('L405083', 0, 0.7134, 0.6735),
			   ('L405084', 0, 0.7435, 0.6735),
			   ('L405085', 0, 0.7716, 0.6735),
			   ('L405086', 0, 0.8004, 0.6735),
			   ('L405087', 0, 0.8279, 0.6735),
			   ('L405088', 0, 0.8580, 0.6735),
			   ('L405089', 0, 0.8907, 0.6735),
			   ('L405090', 0, 0.8017, 0.8582),
			   ('L405091', 0, 0.8017, 0.8906),
			   ('L405092', 0, 0.8724, 0.8582),
			   ('L405093', 0, 0.8724, 0.8906),

		 	   ('L406010', 2, 0.88, 0.3),
		 	   ('L407010', 2, 0.88, 0.3),
		 	   ('L101009', 2, 0.62, 0.2),
		 	   ('L205010', 2, 0.88, 0.3),
		 	   ('L306010', 2, 0.88, 0.3)";

if ($conn->query($sql) === TRUE) {
    echo "新记录插入成功\n";
} else {
    echo "Error: " . $sql . "<br>" . $conn->error;
}

mysqli_query($conn, "UPDATE Seats SET curr_user_id='test',state=2 WHERE seat_id='L405001';");


$conn->close();
?>